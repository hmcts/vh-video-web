<div *ngIf="loadingData">
  <p class="govuk-body">Loading please wait...</p>
</div>

<div *ngIf="showVideo" class="govuk-grid-row">
  <div class="video-background"></div>
  <div class="govuk-grid-column-one-half">
    <video id="incomingFeed" autoplay height="auto">
      Your browser does not support Video
    </video>
  </div>
</div>

<div *ngIf="showVideo && isAdminConsultation" class="govuk-grid-row">
  <div class="video-background"></div>
  <div class="govuk-grid-column-one-half">
    <video id="incomingFeedPrivate" autoplay [srcObject]="this.stream" height="auto">
      Your browser does not support Video
    </video>
  </div>
</div>

<div class="govuk-grid-row" *ngIf="showSelfView">
  <div class="govuk-grid-column-one-half" id="outgoingFeedDiv">
    <button
      id="outgoingFeedButton"
      type="button"
      class="govuk-button govuk-button--secondary reduce-margin govuk-!-margin-right-4"
      data-module="govuk-button"
      (click)="toggleView()"
    >
      {{ selfViewOpen ? 'Close' : 'Open' }} self-view
    </button>

    <video
      [ngClass]="{ showVideo: selfViewOpen, hideVideo: !selfViewOpen }"
      id="outgoingFeedVideo"
      [muted]="true"
      [srcObject]="this.outgoingStream"
      autoplay
      height="auto"
    >
      Your browser does not support Video
    </video>

    <ng-container *ngIf="connected && showVideo">
      <ng-container *ngIf="!remoteMuted">
        <span *ngIf="!audioMuted; else unmuteButton">
          <button
            id="muteButton"
            class="govuk-button reduce-margin"
            data-module="govuk-button"
            type="button"
            (click)="toggleMute()"
            aria-label="Mute Microphone Button"
          >
            Mute
            <span class="govuk-button__start-icon">
              <img id="mute-microphone-img" class="microphoneIcon" src="/assets/images/mic_on.png" alt="Mute Microphone Image" />
            </span>
          </button>
        </span>
      </ng-container>

      <ng-template #unmuteButton>
        <span>
          <button
            id="unmuteButton"
            class="govuk-button govuk-button--warning reduce-margin"
            data-module="govuk-button"
            type="button"
            (click)="toggleMute()"
            aria-label="Unmute Microphone Button"
          >
            Unmute

            <span class="govuk-button__start-icon microphoneIcon">
              <img id="unmute-microphone-img" class="microphoneIcon" src="/assets/images/mic_off.png" alt="Unmute Microphone Image" />
            </span>
          </button>
        </span>
      </ng-template>
    </ng-container>
  </div>

  <div *ngIf="isSupportedBrowserForNetworkHealth" id="hearing-monitor-div">
    <app-waiting-room-monitor [participant]="participant"></app-waiting-room-monitor>
  </div>
</div>

<div *ngIf="!loadingData && conference">
  <a id="back-to-hearing-list-link" href="javascript:void(0)" (click)="goToJudgeHearingList()" class="govuk-back-link">
    Return to video hearing list
  </a>

  <div class="govuk-!-margin-top-5" *ngIf="isNotStarted() || isPaused()">
    <button id="check-equipment-btn" class="govuk-button" data-module="govuk-button" (click)="checkEquipment()" aria-label="Camera Check">
      Check equipment
    </button>
  </div>

  <table class="govuk-table vh-fullwidth">
    <tbody class="govuk-table__body">
      <tr class="govuk-table__row">
        <td class="govuk-table__cell hearing-details-col1-width">
          <strong>{{ conference.case_name }}</strong> ({{ conference.case_type }}) <span>case number</span>:
          <strong>{{ conference.case_number }}</strong>
        </td>
        <td class="govuk-table__cell hearing-details-col2-width">
          {{ hearing.scheduledStartTime | date: 'dd MMMM	yyyy' }}
          <span class="govuk-!-font-weight-bold">
            {{ hearing.scheduledStartTime | date: 'HH:mm' }} to
            {{ hearing.scheduledEndTime | date: 'HH:mm' }}
          </span>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="!loadingData && conference" class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl" [ngClass]="hearingSuspended() ? 'text-highlight-red' : ''">
      {{ getConferenceStatusText() }}
    </h1>

    <h2 class="govuk-heading-m" *ngIf="isNotStarted()">Is everyone connected?</h2>

    <p class="govuk-body govuk-!-margin-bottom-3" *ngIf="isNotStarted()">
      If any participants are not connected, you must call the video hearings team on <strong>0300 303 0655</strong> before you start the
      hearing.
    </p>

    <p class="govuk-body govuk-!-margin-bottom-3" *ngIf="hearingPaused()">
      Please call the video hearings team on <strong>0300 303 0655</strong> if you're having problems. We'll update the participants.
    </p>

    <p class="govuk-body govuk-!-margin-bottom-3" *ngIf="hearingSuspended()">
      The video hearings team has been alerted and we're informing the participants. Please call us now on <strong>0300 303 0655</strong>.
    </p>

    <p class="govuk-body govuk-body govuk-!-margin-bottom-6 govuk-!-margin-top-6">
      <span class="govuk-button__start-icon vh-left">
        <img
          id="recording-on-img"
          class="audio-icon"
          src="/assets/images/{{ conference.audio_recording_required ? 'audio_on' : 'audio_off' }}.png"
          alt="Recording {{ conference.audio_recording_required ? 'on' : 'off' }} image"
        />
      </span>
      <strong class="govuk-!-padding-1">
        The audio of this hearing is {{ conference.audio_recording_required ? '' : 'NOT' }} being recorded.
      </strong>
    </p>

    <div>
      <button *ngIf="isNotStarted()" type="submit" class="govuk-button govuk-button--start" (click)="startHearing()">
        Start video hearing
      </button>
      <button *ngIf="hearingPaused() || hearingSuspended()" type="submit" class="govuk-button govuk-button--start" (click)="startHearing()">
        Resume video hearing
      </button>
    </div>
  </div>

  <div class="govuk-grid-column-one-third">
    <app-judge-participant-status-list aria-label="list of participants in hearing" [conference]="conference">
    </app-judge-participant-status-list>
  </div>
</div>

<app-participant-chat *ngIf="hearing && !showVideo" [hearing]="hearing"></app-participant-chat>
