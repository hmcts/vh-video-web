<div *ngIf="loadingData">
  <p class="govuk-body">Loading please wait...</p>
</div>

<div *ngIf="showVideo" class="govuk-grid-row">
  <div class="video-background"></div>
  <div class="govuk-grid-column-one-half">
    <video id="incomingFeed" [srcObject]="this.stream" autoplay height="auto">
      Your browser does not support Video
    </video>
  </div>
</div>
<div *ngIf="showVideo" class="govuk-grid-row">
  <div class="govuk-grid-column-one-half" id="outgoingFeedDiv">
    <button id="outgoingFeedButton" type="button" class="govuk-button govuk-button--secondary reduce-margin" data-module="govuk-button"
      (click)="toggleView()">
      {{ selfViewOpen ? 'Close' : 'Open' }} self-view
    </button>
    <video *ngIf="selfViewOpen" id="outgoingFeedVideo" [muted]="true" [srcObject]="this.outgoingStream" autoplay height="auto">
      Your browser does not support Video
    </video>
  </div>
</div>

<div *ngIf="!loadingData && hearing" class="govuk-grid-row">

  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-xl">Your video hearing {{ getConferenceStatusText() }}</h1>

    <table class="govuk-table vh-fullwidth">
      <tbody class="govuk-table__body">
        <tr class="govuk-table__row">
          <td class="govuk-table__cell hearing-details-col1-width">
            <strong>{{ hearing.conference.case_name }}</strong> ({{ hearing.conference.case_type }}) 
              <span>case number</span>:
            <strong>{{ hearing.conference.case_number }}</strong>
          </td>
          <td class="govuk-table__cell hearing-details-col2-width">
            {{ hearing.conference.scheduled_date_time | date: 'dd MMMM	yyyy' }}
            <span class="govuk-!-font-weight-bold">
              {{ hearing.scheduledStartTime | date: 'HH:mm a' }} to
              {{ hearing.scheduledEndTime | date: 'HH:mm a' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="govuk-grid-column-two-thirds">
    <div
      *ngIf="!showVideo && currentTime && ( hearing.isNotStarted() || hearing.isPaused() || hearing.isSuspended() || hearing.isClosed()  )"
      class="govuk-panel"
      [ngClass]="{'hearing-on-time': hearing.isOnTime() || hearing.isPaused() || hearing.isClosed(), 'hearing-near-start': hearing.isStarting(), 'hearing-delayed': hearing.isDelayed() || hearing.isSuspended()}">
      <div class="govuk-body govuk-!-margin-bottom-0"
        [ngClass]="{'hearing-on-time': hearing.isOnTime() || hearing.isPaused() || hearing.isClosed(), 'hearing-near-start': hearing.isStarting(), 'hearing-delayed': hearing.isDelayed() || hearing.isSuspended()}">

        <div *ngIf="hearing.isOnTime()">
          <h3 class="govuk-heading-m white">Please keep an eye on the time</h3>
          <p>Make sure you're ready when the judge starts the hearing.</p>
        </div>

        <div *ngIf="hearing.isStarting()">
          <h3 class="govuk-heading-m white">Please stay near your screen</h3>
          <p>Make sure you're ready when the judge starts the hearing.</p>
        </div>

        <div *ngIf="hearing.isDelayed()">
          <h3 class="govuk-heading-m">We're really sorry your hearing is delayed</h3>
          <p>
            Please stand by and one of the video hearing team will call you in the next 5 minutes on the number you
            have given us.
          </p>
        </div>

        <div *ngIf="hearing.isClosed()">
          <h3 class="govuk-heading-m white">This hearing has finished. You may now sign out.</h3>
        </div>

        <div *ngIf="hearing.isPaused()" class="hearing-title-mt--20">
          <p>The judge will re-start the hearing when they are ready. Please stay near your screen.</p>
        </div>

        <div *ngIf="hearing.isSuspended()">
          <h3 class="govuk-heading-m">We're having technical issues</h3>
          <p>
            Please wait while we try to re-start the hearing. All participants are affected. We'll call to update you
            - there's no need to call us.
          </p>
        </div>

      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-half">
          <div class="govuk-panel__body govuk-!-margin-top-4">
            <app-analogue-clock [hearing]="hearing"></app-analogue-clock>
          </div>
        </div>
        <div class="govuk-grid-column-one-half">
          <div class="govuk-body"
            [ngClass]="{'hearing-on-time': hearing.isOnTime() || hearing.isPaused() || hearing.isClosed(), 'hearing-near-start': hearing.isStarting(), 'hearing-delayed': hearing.isDelayed() || hearing.isSuspended()}">
            <p class="govuk-!-margin-bottom-4">The time now is:</p>
            <p class="govuk-panel__body govuk-!-margin-top-4 govuk-!-font-size-80">
              <strong>{{ currentTime | date:'HH:mm' }}</strong>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="govuk-!-margin-top-9">
      <p class="govuk-body"><strong>Video hearings team: 0300 303 0655</strong></p>
    </div>
  </div>

  <div class="govuk-grid-column-one-third">
    <app-individual-participant-status-list aria-label="list of participants in hearing"
      [conference]="hearing.getConference()">
    </app-individual-participant-status-list>
  </div>
</div>

<app-individual-consultation-controls (cancelConsulation)="onConsultationCancelled()" *ngIf="showConsultationControls">
</app-individual-consultation-controls>