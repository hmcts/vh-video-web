<div *ngIf="loadingData">
  <p class="govuk-body">Loading please wait...</p>
</div>

<div *ngIf="showVideo && !isPrivateConsultation" class="govuk-grid-row">
  <div class="video-background"></div>
  <div class="govuk-grid-column-one-half">
    <video id="incomingFeed" autoplay height="auto">
      Your browser does not support Video
    </video>
  </div>
</div>

<div *ngIf="showVideo && isPrivateConsultation" class="govuk-grid-row">
  <div class="video-background"></div>
  <div class="govuk-grid-column-one-half">
    <video id="incomingFeedPrivate" autoplay [srcObject]="this.stream" height="auto">
      Your browser does not support Video
    </video>
  </div>
</div>
<div class="govuk-grid-row" *ngIf="showSelfView">
  <div class="govuk-grid-column-one-half" id="outgoingFeedDiv">
    <button
      id="outgoingFeedButton"
      type="button"
      class="govuk-button govuk-button--secondary reduce-margin govuk-!-margin-right-4"
      data-module="govuk-button"
      (click)="toggleView()"
    >
      {{ selfViewOpen ? 'Close' : 'Open' }} self-view
    </button>

    <video
      [ngClass]="{ showVideo: selfViewOpen, hideVideo: !selfViewOpen }"
      id="outgoingFeedVideo"
      [muted]="true"
      [srcObject]="this.outgoingStream"
      autoplay
      height="auto"
    >
      Your browser does not support Video
    </video>

    <span *ngIf="!audioMuted; else unmuteButton">
      <button
        id="muteButton"
        class="govuk-button reduce-margin"
        data-module="govuk-button"
        type="button"
        (click)="muteUnmuteCall()"
        aria-label="Mute Microphone Button"
      >
        Mute

        <span class="govuk-button__start-icon">
          <img id="mute-microphone-img" class="microphoneIcon" src="/assets/images/mic_on.png" alt="Mute Microphone Image" />
        </span>
      </button>
    </span>
    <ng-template #unmuteButton>
      <span>
        <button
          id="unmuteButton"
          class="govuk-button govuk-button--warning reduce-margin"
          data-module="govuk-button"
          type="button"
          (click)="muteUnmuteCall()"
          aria-label="Unmute Microphone Button"
        >
          Unmute

          <span class="govuk-button__start-icon microphoneIcon">
            <img id="unmute-microphone-img" class="microphoneIcon" src="/assets/images/mic_off.png" alt="Unmute Microphone Image" />
          </span>
        </button>
      </span>
    </ng-template>
  </div>
</div>

<div *ngIf="!loadingData && hearing" class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="govuk-!-padding-top-5">
      <h1 class="govuk-heading-xl govuk-!-padding-top-5">Your video hearing {{ getConferenceStatusText() }}</h1>
    </div>

    <table class="govuk-table vh-fullwidth" aria-describedby="Details of the hearing">
      <thead class="govuk-table__head no-mass">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Hearing</th>
          <th scope="col" class="govuk-table__header">Date</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        <tr class="govuk-table__row">
          <td class="govuk-table__cell hearing-details-col1-width">
            <strong>{{ hearing.caseName }}</strong> ({{ hearing.caseType }}) <span>case number</span>:
            <strong>{{ hearing.caseNumber }}</strong>
          </td>
          <td class="govuk-table__cell hearing-details-col2-width">
            {{ hearing.scheduledStartTime | date: 'dd MMMM	yyyy' }}
            <span class="govuk-!-font-weight-bold">
              {{ hearing.scheduledStartTime | date: 'HH:mm' }} to
              {{ hearing.scheduledEndTime | date: 'HH:mm' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="govuk-grid-column-two-thirds">
    <div
      *ngIf="!showVideo && currentTime && (hearing.isNotStarted() || hearing.isPaused() || hearing.isSuspended() || hearing.isClosed())"
      class="govuk-panel"
      [ngClass]="getCurrentTimeClass()"
    >
      <div class="govuk-body govuk-!-margin-bottom-0" [ngClass]="getCurrentTimeClass()">
        <div *ngIf="hearing.isOnTime()">
          <h2 class="govuk-heading-m white">Please wait</h2>
          <p class="white">Your video hearing is scheduled to begin at {{ hearing.scheduledStartTime | date: 'HH:mm' }}</p>
        </div>

        <div *ngIf="hearing.isStarting()">
          <h2 class="govuk-heading-m white">Please stay near your screen</h2>
          <p class="white">Make sure you're ready when the judge starts the hearing.</p>
        </div>

        <div *ngIf="hearing.isDelayed()">
          <h2 class="govuk-heading-m">Your hearing is delayed</h2>
          <p>
            We're sorry for the delay. Stay near your screen for further updates.
          </p>
        </div>

        <div *ngIf="hearing.isClosed()">
          <h2 class="govuk-heading-m white">This hearing has finished. You may now sign out.</h2>
        </div>

        <div *ngIf="hearing.isPaused()" class="hearing-title-mt--20">
          <p class="white">The judge will restart the hearing when they are ready. Please stay near your screen.</p>
        </div>

        <div *ngIf="hearing.isSuspended()">
          <h2 class="govuk-heading-m">We're having technical issues</h2>
          <p>
            All participants are affected. Stay near your screen for further updates. There's no need to call us.
          </p>
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-half">
          <div class="govuk-panel__body govuk-!-margin-top-4">
            <app-analogue-clock [hearing]="hearing"></app-analogue-clock>
          </div>
        </div>
        <div class="govuk-grid-column-one-half">
          <div class="govuk-body" [ngClass]="getCurrentTimeClass()">
            <p class="govuk-!-margin-bottom-4" [ngClass]="getCurrentTimeClass()">The time now is:</p>
            <p class="govuk-panel__body govuk-!-margin-top-4 govuk-!-font-size-80" [ngClass]="getCurrentTimeClass()">
              <strong>{{ currentTime | date: 'HH:mm' }}</strong>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="govuk-!-margin-top-9">
      <p class="govuk-body"><strong>Video hearings team: 0300 303 0655</strong></p>
    </div>
  </div>

  <div class="govuk-grid-column-one-third">
    <app-individual-participant-status-list aria-label="list of participants in hearing" [conference]="hearing.getConference()">
    </app-individual-participant-status-list>
  </div>
</div>

<app-individual-consultation-controls (cancelConsulation)="onConsultationCancelled()" *ngIf="showConsultationControls">
</app-individual-consultation-controls>

<app-participant-chat *ngIf="hearing && !showVideo" [hearing]="hearing"></app-participant-chat>
